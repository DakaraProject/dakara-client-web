/**
 * Dakara project
 *
 * Song style file
 */

/* Provides:

`listing-entry-song` subclass.
`tag` class.

*/

/* `listing-entry-song` subclass:

The `listing-entry-song` class is a specialization of the `listing-entry` class
defined in the `listing` module, which is aimed to stylize the specific elements
of a list of songs.

The song can be represented in a compact, one-line view or in an expanded,
multi-lines view. More elements are present in the expanded view, which takes
usually more space and have larger margins compared to the compact view. The
compact view stays even if the expandes view is displayed, it only contains less
elements. The expanded view has a appearance/disappearance animation where the
expanded line grows or shrink vertically from the top.

*/

.listing-entry.listing-entry-song {
    // this list entry is not hoverizable, in order to make only the compact
    // view react to hover

    // song compact view
    // this class must be used with the `hoverizable` subclass
    .song-compact {
        display: flex;

        // TODO simplify that
        .song-display {
            .song-view {
                flex: 1;

                .song-preview {
                    display: flex;
                    align-items: center;
                    padding-left: @gap-horizontal;
                    position: relative;
                    overflow-y: hidden;
                    cursor: pointer;
                    height: @listing-entry-height;

                    .title-header {
                        flex: 1;

                        // this is a hack
                        width: 0;

                        * {
                            display: inline;
                        }

                        .title {
                            .text-truncate();
                            font-size: 1.05em;
                        }

                        .version {
                            margin-left: 0.5em;
                            opacity: 0.65;
                        }
                    }

                    .song-preview-details {
                        .make-song-preview-details(0.9em, @black-70);
                        margin-right: @gap-horizontal;
                        align-items: flex-end;
                    }

                    .song-tag-list {
                        position: absolute;
                        bottom: 0;
                        left: 0;
                        font-size: 0.6em;
                        line-height: 1em;
                    }
                }
            }

            // class for song duration
            // TODO simplify that: does it really need a `content`?
            .duration {
                .duration-content {
                    font-size: 0.85em;
                    line-height: @listing-entry-height;
                    width: @listing-entry-height;
                    background: @text-light;
                    color: @neutral-mid;
                    text-align: center;
                }
            }
        }

        // class for data relative to the status of the song in the playlist
        // TODO should be at the same level of `duration`...
        // TODO simplify that: does it really need a `content`?
        .playlist-info {
            display: flex;
            align-items: flex-start;

            .playlist-info-content {
                line-height: @listing-entry-height;
                background: @brand-info;
                color: @text-dark;
                text-align: center;

                .play-time {
                    min-width: (2 * @listing-entry-height);

                    i {
                        padding-right: 0.5em;
                    }
                }

                .playing {
                    width: @listing-entry-height;
                }

                // appearance transition of the playlist info class
                &.playlist-info-enter {
                    max-width: 0;
                    overflow: hidden;

                    &.playlist-info-enter-active {
                        max-width: (2 * @listing-entry-height);
                        .transition(max-width 300ms ease-out);
                    }
                }

                // disappearance transition of the playlist info class
                &.playlist-info-leave {
                    max-width: (2 * @listing-entry-height);
                    overflow: hidden;

                    &.playlist-info-leave-active {
                        max-width: 0;
                        .transition(max-width 150ms ease-out);
                    }
                }
            }
        }

        // hover of the compact view
        &:hover {
            .song-display .duration .duration-content {
                background: @neutral-clear-lighter;
            }

            .playlist-info .playlist-info-content {
                background: @brand-info-lighter;
            }
        }
    }

    // alternatiion of the compact view
    &:nth-child(2n) {
        .song-display .duration .duration-content {
            background: @neutral-clear-light;
        }

        .playlist-info .playlist-info-content {
            background: @brand-info-light;
        }
    }

    // song expanded view
    // should not be used with the `hoverized` subclass
    .song-expanded-details {
        @height: 0.75 * @listing-entry-height;
        padding-bottom: @height;

        .expanded-item {
            &:not(:last-child) {
                margin-bottom: @height;;
            }

            .header {
                line-height: @height;
                padding: 0 @gap-horizontal;
                margin: 0;
                font-weight: normal;
                // background: @neutral-clear;
                // color: @neutral-mid;
                box-sizing: border-box;
                width: 120px;

                .icon {
                }

                .name {
                   padding-left: 0.5em; 
                }
            }

            .list {
                list-style-type: none;
                padding: 0;

                .entry {
                    line-height: @height;
                    height: @height;
                    display: flex;


                    .artist,.work {
                        background: @neutral-mid-lighter;
                    }

                    &:nth-child(odd) .artist,.work {
                        background: @neutral-mid-light;
                    }

                    .controls {
                        .make-controls(@height, 0.85 * @listing-entry-control-font-size);
                    }
                }
            }

            .text {
                padding: 0 @gap-horizontal;
            }
        }

        .artists {
            .entry {
                .artist {
                    flex: 1;
                    padding: 0 @gap-horizontal;
                }
            }
        }

        .works {
            .entry {
                .work {
                    .make-song-work(@black-70, 0.81em);

                    flex: 1;
                    padding: 0 @gap-horizontal;

                    > * {
                        display: inline;
                    }
                }
            }
        }

        .expanded-detail {
            line-height: @height;

            .group {
                display: flex;
            }

            // &:nth-child(odd) .header {
            //     background: @neutral-clear-light;
            // }

            .text,.song-tag-list {
                background: @neutral-mid-lighter;
            }

            &:nth-child(odd) .text,.song-tag-list {
                background: @neutral-mid-light;
            }

            .header {
                padding: 0 @gap-horizontal;
                margin: 0;
                font-weight: normal;
                // background: @neutral-clear;
                // color: @neutral-mid;
                box-sizing: border-box;
                width: 150px;

                .icon {
                }

                .name {
                   padding-left: 0.5em; 
                }
            }

            .text, .song-tag-list {
                flex: 1;

            }

            .text {
                padding: 0 @gap-horizontal;
            }
        }

        // appearance transition of the expanded view
        &.expand-view-enter {
            overflow: hidden;
            max-height: 0;

            &.expand-view-enter-active {
                max-height: @height * 10;
                .transition(max-height 600ms ease-out);
            }
        }

        // disappearance transition of the expanded view
        &.expand-view-leave {
            overflow: hidden;
            max-height: @height * 10;

            &.expand-view-leave-active {
                max-height: 0;
                .transition(max-height 300ms ease-out);
            }
        }
    }
}

.make-song-work(@border-color, @link-font-size: 0.9em) {
    > *:not(:first-child) {
        margin-left: 0.5em;
    }

    .link {
        .link-content {
            text-transform: uppercase;
            border: solid 1px @border-color;
            padding: 0 2px;
            font-size: @link-font-size;
        }
    }

    .subtitle {
        opacity: 0.65;
    }

    .title {
    }

    .type {
    }
}

.make-song-preview-details(@font-size, @border-color) {
    display: flex;
    flex-direction: column;
    font-size: @font-size;

    .artists {
        .artist:not(:last-child)::after {
            content: ", ";
        }
    }

    .work {
        .make-song-work(@border-color);

        * {
            display: inline;
        }
    }
}

/*
.make-song-view(@height, @height-header, @type-font-size, @listing-entry-control-font-size) {
    @color-light: darken(@neutral-clear, 7%);
    @color-dark: darken(@neutral-mid, 2%);

    .title-header {
        padding: 0 @gap-horizontal;
        height: @height-header;
        display: flex;
        align-items: center;
        cursor: pointer;

        * {
            display: inline;
        }

        .title {
            font-size: 1.05em;
        }

        .detail {
            margin-left: 0.5em;
            opacity: 0.65;
        }
    }

    .make-sublisting() {
        margin: 0;
        padding: 0;
        // background: @black-80;
        list-style-type: none;
        overflow-x: hidden;

        > li {
            display: flex;
            padding-left: @gap-horizontal;

            .controls {
                .make-controls(@height, @listing-entry-control-font-size);
            }
        }
    }

    .works {
        .works-list {
            .make-sublisting();

            > li {
                .work {
                    flex: 1;
                    display: flex;
                    align-items: center;

                    .make-song-work(darken(@black-70, 2%));

                    .work-link {
                        flex: 1;
                    }

                    .work-type {
                        background: @color-light;
                        color: @color-dark;
                    }
                }

                .work-type {
                    font-size: @type-font-size;
                    line-height: @height;
                    width: @height;
                    text-align: center;
                }


                &:nth-child(2n) .work .work-type {
                    background: lighten(@color-light, 2%);
                }

                &:hover .work .work-type {
                    background: lighten(@color-light, 3.5%);
                }
            }
        }
    }

    .artists {
        .artists-list {
            .make-sublisting();

            > li {
                .artist {
                    flex: 1;
                    display: flex;
                    align-items: center;

                    .artist-name {
                    }
                }
            }
        }
    }


    li {
        background: @color-dark;

        &:nth-child(2n) {
            background: lighten(@color-dark, 1.25%);
        }

        &:hover {
            background: lighten(@color-dark, 3.5%);
        }
    }

}
*/

/* `tag` class:

The `tag` class is a basic style for tags in musics. It can be extended with 8
different colorized subclasses.

Its size is determined in the `listing-entry-song` class, whether the song is
displayed in compact or in expanded view.

*/

.tag {
    padding: 0 @gap-horizontal;
    display: inline-block;
    color: fade(@text-dark, 50%);
    font-weight: 700;

    &.clickable {
        cursor: pointer;

        i {
            margin-right: 0.5em;
            font-size: 1.2em;
        }
    }

    &.disabled {
        opacity: 0.5;
    }

    .make-tag(@color) {
        background-color: @color;

        &.clickable {
            &:hover {
                background-color: lighten(@color, 5%);
            }
        }

        &.disabled {
            background-color: desaturate(@color, 50%);
        }
    }

    &.tag-color-0 {
        .make-tag(#1b9e77); 
    }
    &.tag-color-1 {
        .make-tag(#d95f02); 
    }
    &.tag-color-2 {
        .make-tag(#7570b3); 
    }
    &.tag-color-3 {
        .make-tag(#e7298a); 
    }
    &.tag-color-4 {
        .make-tag(#66a61e); 
    }
    &.tag-color-5 {
        .make-tag(#e6ab02); 
    }
    &.tag-color-6 {
        .make-tag(#a6761d); 
    }
    &.tag-color-7 {
        .make-tag(#666666); 
    }
}
