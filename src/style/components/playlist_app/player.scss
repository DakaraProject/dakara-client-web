//
// Dakara Project
//
// Player style file
//


// player sizes
$player-controls-height: 7rem;
$player-progressbar-height: 0.4rem;
$player-height: 2 * $gap-vertical + $player-controls-height + $player-progressbar-height;
$player-height-smartphone: 2 * $gap-vertical-smartphone + 2 * $row-height * 0.6 + $gap-vertical-smartphone + $player-progressbar-height;


// `player` id:
//
// This component stylizes the player, containing controls, song info and a
// progression bar.
#player {
    background: $brand-primary-darker;
    color: $brand-primary;

    // `first-line` class: the main part of the player displays the current
    // song, its numerical progression and the controls of the player.
    .first-line {
        @include make-gap(padding, vertical);

        align-items: center;
        display: flex;

        .display-area {
            @include make-gap(margin, left);

            height: $player-controls-height;
            overflow: hidden;
            width: 100%;

            .notified {
                .animation {
                    line-height: $player-controls-height;
                }
            }
        }

        // `song-container` class: container for info of the song.
        .playlist-entry {
            display: flex;
            overflow: hidden;

            // `use-instrumental` subclass: indicate if the playlist entry use the instrumental track.
            .use-instrumental {
                font-size: 1.45em;
                line-height: 1.5;
                margin-right: 0.5em;
            }

            // `song` subclass: the song itself.
            .song {
                @include make-gap(margin, right);

                align-content: flex-start;
                align-items: initial;
                cursor: pointer;
                flex-direction: column;
                height: $player-controls-height;
                overflow: hidden;

                // remove special colors of disabled songs
                &.disabled {
                    background-color: unset;
                    color: inherit;
                }

                .general {
                    align-items: initial;
                    flex-direction: column;
                }

                .header {
                    flex-grow: initial;
                    font-size: 1.45em;
                    font-weight: 300;

                    // .title {
                    // }

                    // .version {
                    // }
                }

                .artist-work {
                    margin: 0;

                    .artists {
                        text-align: left;
                    }

                    .work-link {
                        @include make-reverse();

                        .link {
                            border-color: shade($brand-primary, 25%);
                        }
                    }
                }
            }

            .extra {
                @mixin make-extra($ratio-extra, $ratio-timing, $font-weight-current, $font-weight-duration) {
                    $height-timing: $ratio-extra * $player-controls-height * 0.95;
                    $height-owner: (1 - $ratio-extra) * $player-controls-height;
                    font-size: $height-timing * $ratio-timing;

                    .timing {
                        .current {
                            font-size: $height-timing * $ratio-timing;
                            font-weight: $font-weight-current;
                            line-height: $height-timing * $ratio-timing;
                        }

                        .duration {
                            font-size: $height-timing * (1 - $ratio-timing);
                            font-weight: $font-weight-duration;
                            line-height: $height-timing * (1 - $ratio-timing);
                        }
                    }

                    .owner {
                        font-size: initial;
                        line-height: $height-owner;
                    }
                }

                @include make-gap(margin, right);
                @include make-extra(0.8, 0.7, 100, initial);

                // shrink the extra class element first when resizing, up to
                // the width of the duration (4 digits plus one colon)
                display: flex;
                flex: 1;
                flex-direction: column;
                min-width: 4.5ch;
                overflow: hidden;

                @include make-smartphone {
                    @include make-extra(0.7, 0.6, 100, 300);
                }

                // `song-timing` class: current progression of the song in numerical
                // form.
                .timing {
                    $ratio-timing: 0.6;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    text-align: right;

                    // .current {
                    // }

                    .duration {
                        opacity: 0.85;
                    }
                }

                // `playlist-entry-owner` class: owner of the playlist entry.
                .owner {
                    overflow: hidden;
                    text-align: right;

                    .user-widget {
                        @include text-truncate();

                        .icon {
                            font-size: 1em;
                        }
                    }
                }
            }
        }
    }

    // `progressbar` class: supplementary visual indicator of the song current
    // progression.
    .progressbar {
        // reset default style
        appearance: none;
        border-style: none;
        display: block;
        height: $player-progressbar-height;
        width: 100%;

        &[value] {
            @mixin make-bar() {
                background: transparent;
            }

            @mixin make-value() {
                background: $brand-primary-dark;
            }

            & {
                // for firefox and ie
                @include make-bar();
            }

            & {
                // for ie
                color: $brand-primary-dark;
            }

            &::-moz-progress-bar {
                // for firefox
                @include make-value();
            }

            &::-webkit-progress-bar {
                // for webkit
                @include make-bar();
            }

            &::-webkit-progress-value {
                // for webkit
                @include make-value();
            }

            // fallback styling
            .bar {
                @include make-bar();

                .value {
                    @include make-value();
                    height: 100%;
                }
            }
        }

        &:not([value]),
        &:indeterminate {
            @mixin make-bar() {
                animation: sliding-animation 1s linear infinite;
                background: repeating-linear-gradient(
                    -45deg,
                    $brand-primary-dark,
                    $brand-primary-dark 2rem,
                    $brand-primary-darker 2rem,
                    $brand-primary-darker 4rem
                );
            }

            & {
                // for firefox and ie
                @include make-bar();
            }

            @keyframes sliding-animation {
                to {
                    background-position-x: 1.41421356 * 4rem;
                }
            }

            &::-webkit-progress-bar {
                // for webkit
                // it does not seem to work for now
                @include make-bar();
            }

            // firefox considers that the bar is at 100%
            &::-moz-progress-bar {
                background: transparent;
            }
        }
    }

    // `controls` subclass: buttons of the player.
    .controls {
        .control {
            overflow: hidden;
            position: relative;

            &.managed-error .managed.managed-enter {
                left: -100%;
            }

            .managed {
                align-items: center;
                display: flex;
                height: 100%;
                justify-content: center;
                left: 0;
                position: absolute;
                top: 0;
                width: 100%;

                // appearance transition
                &.managed-enter {
                    left: 100%;

                    &.managed-enter-active {
                        left: 0;
                        transition: left 150ms ease-out;
                    }
                }

                // appearance transition
                &.managed-exit {
                    left: 0;

                    &.managed-exit-active {
                        left: -100%;
                        transition: left 150ms ease-out;
                    }
                }
            }
        }
    }

    .controls.main {
        @include make-controls($player-controls-height, 1.66em);

        @include make-smartphone {
            @include make-controls($row-height * 0.6, 1.1em);

            flex-direction: column;

            > .control {
                margin: 0;
                width: $row-height;

                &:not(:last-child) {
                    margin-bottom: $gap-vertical-smartphone;
                }
            }
        }
    }

    // this second line of controls has been deactivated
    .controls.other {
        @include make-controls($row-height * 0.6, 1.1em);
        @include make-gap(padding, bottom);

        overflow: hidden;
        transition: height 150ms, padding-bottom 150ms;

        &.reduced {
            height: 0;
            padding-bottom: 0;
            transition: height 150ms, padding-bottom 150ms;
        }


        > .control {
            width: $row-height;
        }
    }
}
